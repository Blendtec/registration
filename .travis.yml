sudo: required
dist: trusty
git:
  depth: 1
language: node_js
node_js:
- '6'
- '7'
- stable
addons:
  apt:
    sources:
    - google-chrome
    packages:
    - google-chrome-stable
matrix:
  fast_finish: true
install:
- npm install
before_script:
- export DBUS_SESSION_BUS_ADDRESS=/dev/null
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
script:
- npm run test:ci
- echo $TRAVIS_BRANCH
- if [ $TRAVIS_BRANCH = 'develop' ]; then npm run build:ci https://s3-us-west-1.amazonaws.com/recipe-stage-client.blendtec.com/
  --base-href /pages/stage-recipes/; fi
- if [ $TRAVIS_BRANCH = 'master' ]; then npm run build:ci https://s3-us-west-1.amazonaws.com/recipe-client.blendtec.com/
  --base-href /pages/recipe-test/; fi
after_success:
- "./node_modules/.bin/codecov"
notifications:
  slack: blendtec:a5Z5i4z3iuWbHHDdlMRSMkiB
env:
  global:
    secure: LnylHUvTeUvYkQrhouaZHAWsE0/Cg/Pzky01dLpBY8ncsEyigRH1J/DXEtLLJ4ytznZ5cKSoZhsL7Dvtj9spOo6j7Q9YfMfmNY7SIrkQo2PJPIswaqAkEA5wLnk1XOSsbiKh6+/W65PQxB44Fz5fzhhN6vWdLxur/CXHxNl+m7r28f0Nv94J8N7v/ZdbU5F5Pp1LM0LSRxGNisXyP4Nz5RjEeo6eKjubt6H/gjPA9crMrbUfpmGPk2WJDG4+KgMwrTVzgUx/TJsCELJXRseWQHkI35MyVzTkMo1se1A/7nz9RKPgAgHkMYGROMAFs7hMVDwT/MgdHdHKTRKfnSP3bG8Rkul5JaB36Yz3yIVuqVIujrQcj8DejVG66xvC8hONWai1ti+77Z/yWJXWrwCkVVaX2Xn/TIOvl8vEXLTRMH5Txzc9EfV8zLd/s908zGIGIxVjtMT27cNRrT6CGjbcd3sWO55ai4b+tokZdpZfxV49PIqdXDyGjMsNKjwiiTlUPx+eiTMiltdaOs12zNNAj9F/gTwwhl/33y5oVhAvLgOh9OzW4ZkctJcMkIwpA+mc/XaC5EVeb0N/DzDbc5+LsZMQozyRudIIzbhbKDOT/WmS6lD3qtvz1sZ87tDQcqiMLn7623fT7D3GRpZGHmHqrvTtXxM2+tTzv5b+7j25Wh8=
deploy:
- provider: s3
  region: us-west-1
  access_key_id: AKIAIBSHRO4SOJ5PIBSQ
  secret_access_key:
    secure: Il9zk3MOxurkDplYAZR5nIb8UwLD1EKc7m8ZMsrOcFU6R8aKhqfQAi02lIPZMgfdFCA+ll3aU3ENRahMhQWsNRL3zmINimaVkTrv91P6Zhp3CvT/fWRTHrKXgUrawI18NOmHEZaoUPY5SWYR2D89ljdf293gRtStmnjU9JdH3HOuDXaAcZ1j5p/oEn8gumn1mZHc2ajJm5RbhqGgtNCiEqP5g/0stKoio8BilHa6yDa/khiSjeVEUb9Os7rP5bumk0IXzALi9noYbCKElJ4JOP+81m9V/zEL5XKrFpT0z5HAwma15lSxdTjh+rO2a+6u0CK/JLuatf1tpz6P3sbHDYKOzDsdsz51DN+XeiLtPn5KE4zqwkWWA2iBzyJIj0OzU110szRYRootOyaitheFjhfrAHwFMaXLzT77/gFhpXPdCjfP7BM02uuUEIATMYZ0uQlrJYkroJh7FXVeixIeQBdno8hvLWV/GY2wAJbG1B0qq7TZ0Mn7fBtVaMdo7lP0kpqn0YCwAuMkGaXskxq/2c1Zg8sPQ6SW1QsrXCifgKjsxRlmK+LDDDbRRK8eWRpbvKVEoGKZ+aglWpJXvx8TS+3k1DpCI0Cj8Iu2Pe11i6TnC+EUULF9rQic+fiHaU1ghpc7UoUaXvRApWRzowxJJHCkTzyF9yNgypYivPFsPbc=
  bucket: recipe-client.blendtec.com
  local-dir: dist
  skip_cleanup: true
  acl: public_read
  on:
    branch: master
- provider: script
  skip_cleanup: true
  script: "./.travis/deploy.sh"
  on:
    branch: master
- provider: s3
  region: us-west-1
  access_key_id: AKIAIBSHRO4SOJ5PIBSQ
  secret_access_key:
    secure: Il9zk3MOxurkDplYAZR5nIb8UwLD1EKc7m8ZMsrOcFU6R8aKhqfQAi02lIPZMgfdFCA+ll3aU3ENRahMhQWsNRL3zmINimaVkTrv91P6Zhp3CvT/fWRTHrKXgUrawI18NOmHEZaoUPY5SWYR2D89ljdf293gRtStmnjU9JdH3HOuDXaAcZ1j5p/oEn8gumn1mZHc2ajJm5RbhqGgtNCiEqP5g/0stKoio8BilHa6yDa/khiSjeVEUb9Os7rP5bumk0IXzALi9noYbCKElJ4JOP+81m9V/zEL5XKrFpT0z5HAwma15lSxdTjh+rO2a+6u0CK/JLuatf1tpz6P3sbHDYKOzDsdsz51DN+XeiLtPn5KE4zqwkWWA2iBzyJIj0OzU110szRYRootOyaitheFjhfrAHwFMaXLzT77/gFhpXPdCjfP7BM02uuUEIATMYZ0uQlrJYkroJh7FXVeixIeQBdno8hvLWV/GY2wAJbG1B0qq7TZ0Mn7fBtVaMdo7lP0kpqn0YCwAuMkGaXskxq/2c1Zg8sPQ6SW1QsrXCifgKjsxRlmK+LDDDbRRK8eWRpbvKVEoGKZ+aglWpJXvx8TS+3k1DpCI0Cj8Iu2Pe11i6TnC+EUULF9rQic+fiHaU1ghpc7UoUaXvRApWRzowxJJHCkTzyF9yNgypYivPFsPbc=
  bucket: recipe-stage-client.blendtec.com
  local-dir: dist
  skip_cleanup: true
  acl: public_read
  on:
    branch: develop
- provider: script
  skip_cleanup: true
  script: "./.travis/deploy_stage.sh"
  on:
    branch: develop
